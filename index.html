<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";

    import {
        getAuth,
        signInWithEmailAndPassword,
        GoogleAuthProvider,
        signInWithPopup
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    import {
        getFirestore,
        doc,
        getDoc,
        setDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ----------------------------------------------------
    // 1) CONFIGURAÇÃO + INICIALIZAÇÃO DO FIREBASE
    // ----------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyCztzjnqsASSgQAGJNNyp0XLzAeeEKclPY",
        authDomain: "controle-de-financas-8bfdf.firebaseapp.com",
        databaseURL: "https://controle-de-financas-8bfdf-default-rtdb.firebaseio.com",
        projectId: "controle-de-financas-8bfdf",
        storageBucket: "controle-de-financas-8bfdf.firebasestorage.app",
        messagingSenderId: "269562705866",
        appId: "1:269562705866:web:58aeae4840ec2c6c7cc133",
        measurementId: "G-BZE9L6267J"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ----------------------------------------------------
    // 2) LOGIN TRADICIONAL (email/senha)
    // ----------------------------------------------------
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const senha = document.getElementById("password").value.trim();

        try {
            await signInWithEmailAndPassword(auth, email, senha);
            window.location.href = "dashboard.html";
        } catch (error) {
            alert("Erro no login: " + error.message);
        }
    });

    // ----------------------------------------------------
    // 3) LOGIN COM GOOGLE
    // ----------------------------------------------------
    const googleProvider = new GoogleAuthProvider();

    document.getElementById("googleLoginBtn").addEventListener("click", async () => {
        try {
            const result = await signInWithPopup(auth, googleProvider);
            const user = result.user;

            // Criar registro no Firestore caso seja o primeiro login
            const ref = doc(db, "usuarios", user.uid);
            const snap = await getDoc(ref);

            if (!snap.exists()) {
                await setDoc(ref, {
                    nome: user.displayName || "",
                    email: user.email,
                    foto: user.photoURL || "",
                    criadoEm: new Date()
                });
            }

            window.location.href = "dashboard.html";

        } catch (error) {
            alert("Erro ao entrar com Google: " + error.message);
        }
    });
</script>
