<script type="module">
    import {
        getAuth,
        signInWithEmailAndPassword,
        GoogleAuthProvider,
        signInWithPopup
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    import {
        getFirestore,
        doc,
        getDoc,
        setDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const auth = getAuth();
    const db = getFirestore();

    // Login tradicional (email/senha)
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const senha = document.getElementById("password").value.trim();

        try {
            await signInWithEmailAndPassword(auth, email, senha);
            window.location.href = "dashboard.html";
        } catch (error) {
            alert("Erro no login: " + error.message);
        }
    });

    // Login com Google
    const googleProvider = new GoogleAuthProvider();

    document.getElementById("googleLoginBtn").addEventListener("click", async () => {
        try {
            const result = await signInWithPopup(auth, googleProvider);
            const user = result.user;

            // Criar registro no Firestore se ainda n√£o existir
            const ref = doc(db, "usuarios", user.uid);
            const snap = await getDoc(ref);

            if (!snap.exists()) {
                await setDoc(ref, {
                    nome: user.displayName || "",
                    email: user.email,
                    foto: user.photoURL || "",
                    criadoEm: new Date()
                });
            }

            window.location.href = "dashboard.html";

        } catch (error) {
            alert("Erro ao entrar com Google: " + error.message);
        }
    });
</script>
